<!DOCTYPE html>
<html>
  <head>
    <title>ミロストル技術社ウェブサイト</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
    /**
     * MQTTクライアントを作成する関数
     * @param {Object} options
     * @param {string} options.brokerUrl 例: "wss://broker.hivemq.com:8884/mqtt"
     * @param {string} options.username
     * @param {string} options.password
     * @param {string} options.clientId
     * @returns {Object}
     */
    function createMQTTClient({ brokerUrl, username, password, clientId }) {
      const client = mqtt.connect(brokerUrl, {
        username: username,
        password: password,
        clientId: clientId,
        clean: true,
        reconnectPeriod: 1000
      });
    
      client.on("connect", () => {
        console.log("✅ MQTT接続成功");
      });
    
      client.on("error", (err) => {
        console.error("❌ MQTTエラー:", err);
      });
    
      client.on("reconnect", () => {
        console.log("🔄 再接続中...");
      });
    
      return {
        /**
         * トピックを購読する
         * @param {string} topic
         * @param {Function} callback (message, topic) => {}
         */
        subscribe(topic, callback) {
          client.subscribe(topic, (err) => {
            if (err) {
              console.error("❌ 購読失敗:", err);
            } else {
              console.log("📡 購読成功:", topic);
            }
          });
    
          client.on("message", (recvTopic, message) => {
            if (recvTopic === topic) {
              callback(message.toString(), recvTopic);
            }
          });
        },
    
        /**
         * メッセージを発行する
         * @param {string} topic
         * @param {string} message
         */
        publish(topic, message) {
          client.publish(topic, message, {}, (err) => {
            if (err) {
              console.error("❌ 発行失敗:", err);
            } else {
              console.log("📤 発行成功:", topic, message);
            }
          });
        },
    
        /**
         * 切断
         */
        disconnect() {
          client.end();
          console.log("🔌 切断しました");
        }
      };
    }
    </script>
  </head>
  <body>
    <header>ミロストル技術社ウェブサイト/ミロストル通信ネットワーク</header>
    <h1>ミロストル簡易独立電子メール</h1>
    <p>関係者以外は閲覧をおやめください</p>
    説明<br>
    「独立」っていうのは、GmailとかYahoo!メールと違って、このサービス間でしかメールを送受信できないっていうこと。
    <span style="color: red; background: yellow;">注意！必ずの時間内にスケジュールに従ってください！<button id="con">接続</button>早すぎも おそすぎも だめです！</span>
    <address>
      連絡先<br>
      電子メール takikawatouma@gmail.com<br>
      小学校 6年3組15番
    </address>
    <script>
      document.getElementById("con").addEventListener("click", function() {
        console.log("ボタンが押されました");
      });
    </script>
  </body>
</html>
